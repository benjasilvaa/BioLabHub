<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EquipReserve | BIOLABHUB</title>
  <link rel="icon" href="{{ url_for('static', filename='assets/LOGO-SOLO.ico') }}" type="image/png">
  <link rel="stylesheet" href="{{ url_for('static', filename='equipreserve/EquipReserve.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet">
</head>

<body>
  <nav class="navbar">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='assets/BioLabHub (negro).png') }}">
    </div>
    <div class="user-avatar">
      <span>ğŸ‘¤ {{ session['nombre'] }}</span>
      <a href="{{ url_for('login_bp.logout') }}" class="logout-btn">Cerrar sesiÃ³n</a>
    </div>
  </nav>

  <div class="content">
    <div class="sidebar">
      <nav>
        <a href="{{ url_for('home') }}">Inicio</a>
        <a href="{{ url_for('samples_bp.samples') }}">SampleTrack</a>
        <a href="{{ url_for('experiments_bp.experiments') }}">Experiment Planner</a>
        <a href="{{ url_for('reagents') }}">ReagentVault</a>
        <a href="{{ url_for('equipments_bp.equipreserve') }}" class="active">EquipReserve</a>
        {% if session.get("rol") == "admin" %}
        <a href="{{ url_for('admin_bp.admin_panel') }}" style="color: #ffcc00; font-weight: bold;">
          ğŸ›  Panel Admin
        </a>
        {% endif %}
      </nav>
    </div>

    <div class="main">
      <h1>ğŸ§° EquipReserve â€“ Reservas de Equipos</h1>

      {% with mensajes = get_flashed_messages(with_categories=true) %}
        {% if mensajes %}
          {% for categoria, mensaje in mensajes %}
            <div class="alerta {{ categoria }}">{{ mensaje }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form class="form-nuevo" method="POST" action="{{ url_for('equipments_bp.add_reserva') }}">
        <h2>â• Nueva Reserva</h2>

        <label>Equipo:</label>
        <select name="equipo" required>
          <option value="">-- Selecciona un equipo --</option>
          {% for e in equipos %}
            <option value="{{ e['nombre'] }}">{{ e['nombre'] }}</option>
          {% endfor %}
        </select>

        <label>Inicio:</label>
        <input type="datetime-local" name="fecha_inicio" required>

        <label>Fin:</label>
        <input type="datetime-local" name="fecha_fin" required>

        <button type="submit">Reservar equipo</button>
      </form>

      <h2>ğŸ—“ï¸ Calendario</h2>
      <div id="calendar"></div>

      <div id="eventos" class="eventos"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarEl = document.getElementById('calendar');

      window.calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'es',
        height: 650,
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        events: "{{ url_for('equipments_bp.equipreserve_events') }}"
      });

      window.calendar.render();
    });
  </script>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="/static/socket.js"></script>

  <script>
    // ğŸ”¥ Cuando el servidor avisa que algo cambiÃ³ â†’ recargar eventos
    socket.on("refresh_calendar", (data) => {
      console.log("ğŸ”„ Actualizando calendario:", data.msg);
      window.calendar.refetchEvents();
    });
  </script>

</body>
</html>
