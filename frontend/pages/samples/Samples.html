<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SampleTrack | BIOLABHUB</title>
  <link rel="icon" href="{{ url_for('static', filename='assets/LOGO-SOLO.ico') }}" type="image/png">
  <link rel="stylesheet" href="{{ url_for('static', filename='samples/Samples.css') }}">

  <style>
    /* ===== CARDS DEL DASHBOARD ===== */
    .stats-cards {
      display: flex;
      gap: 20px;
      margin-bottom: 25px;
      margin-top: 10px;
    }
    .stat-card {
      flex: 1;
      padding: 18px;
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid #ddd;
      text-align: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: 0.2s;
    }
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .stat-title {
      font-size: 15px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .stat-number {
      font-size: 26px;
      font-weight: bold;
      color: #1a73e8;
    }
  </style>
</head>

<body>
  <!-- üîµ Navbar -->
  <nav class="navbar">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='assets/BioLabHub (negro).png') }}" alt="BioLabHub Logo">
    </div>
    <div class="user-avatar">
      <span>üë§ {{ session['nombre'] if 'nombre' in session else 'Invitado' }}</span>
      <a href="{{ url_for('login_bp.logout') }}" class="logout-btn">Cerrar sesi√≥n</a>
    </div>
  </nav>

  <div class="content">
    <!-- Sidebar -->
    <div class="sidebar">
      <nav>
        <a href="{{ url_for('home_bp.home') }}">Inicio</a>
        <a href="{{ url_for('samples_bp.samples') }}" class="active">SampleTrack</a>
        <a href="{{ url_for('experiments_bp.experiments') }}">Experiment Planner</a>
        <a href="{{ url_for('reagents') }}">ReagentVault</a>
        <a href="{{ url_for('equipments_bp.equipreserve') }}">EquipReserve</a>
        {% if session.get("rol") == "admin" %}
        <a href="{{ url_for('admin_bp.admin_panel') }}" style="color: #ffcc00; font-weight: bold;">
          üõ† Panel Admin
        </a>
        {% endif %}
      </nav>
    </div>
    <!-- Contenido principal -->
    <div class="main">
      <h1>üß´ SampleTrack ‚Äì Seguimiento de Muestras</h1>

      <!-- ====== CARDS DE ESTAD√çSTICAS ====== -->
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-title">Total Activas</div>
          <div class="stat-number">{{ stats.total_activos }}</div>
        </div>

        <div class="stat-card">
          <div class="stat-title">En an√°lisis</div>
          <div class="stat-number">{{ stats.en_analisis }}</div>
        </div>

        <div class="stat-card">
          <div class="stat-title">En almacenamiento</div>
          <div class="stat-number">{{ stats.en_almacenamiento }}</div>
        </div>

        <div class="stat-card">
          <div class="stat-title">Descartadas</div>
          <div class="stat-number">{{ stats.descartadas }}</div>
        </div>

        <div class="stat-card">
          <div class="stat-title">Mis muestras</div>
          <div class="stat-number">{{ stats.mis_muestras }}</div>
        </div>
      </div>


      <!-- Formulario nueva muestra -->
      <form class="form-nueva" method="POST" action="{{ url_for('samples_bp.add_sample') }}">
        <input type="text" name="nombre" placeholder="Nombre de la muestra" required>
        <input type="text" name="tipo" placeholder="Tipo">

        <select name="ubicacion" required>
          <option value="">-- Seleccionar laboratorio --</option>
          {% for lab in laboratorios %}
            <option value="{{ lab['nombre'] }}">{{ lab['nombre'] }}</option>
          {% endfor %}
        </select>

        <select name="estado">
          <option value="En almacenamiento">En almacenamiento</option>
          <option value="En an√°lisis">En an√°lisis</option>
          <option value="Descartada">Descartada</option>
        </select>

        <button type="submit">Agregar</button>
      </form>

      <!-- Listado de muestras -->
      <h2>üìã Muestras registradas</h2>
      {% if muestras %}
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Responsable</th>
            <th>Ubicaci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for m in muestras %}
          <tr>
            <form method="POST" action="{{ url_for('samples_bp.update_sample', id=m['id']) }}">
              <td><input name="nombre" value="{{ m['nombre'] }}"></td>
              <td><input name="tipo" value="{{ m['tipo'] }}"></td>
              <td>
                <select name="estado">
                  <option value="En almacenamiento" {% if m['estado']=='En almacenamiento' %}selected{% endif %}>En almacenamiento</option>
                  <option value="En an√°lisis" {% if m['estado']=='En an√°lisis' %}selected{% endif %}>En an√°lisis</option>
                  <option value="Descartada" {% if m['estado']=='Descartada' %}selected{% endif %}>Descartada</option>
                </select>
              </td>
              <td>{{ m['responsable'] or '‚Äî' }}</td>
              <td>
                <select name="ubicacion">
                  {% for lab in laboratorios %}
                    <option value="{{ lab['nombre'] }}" {% if m['ubicacion'] == lab['nombre'] %}selected{% endif %}>
                      {{ lab['nombre'] }}
                    </option>
                  {% endfor %}
                </select>
              </td>
              <td>
                <button type="submit">üíæ</button>
                <a href="{{ url_for('samples_bp.delete_sample', id=m['id']) }}" onclick="return confirm('¬øEliminar muestra?')">üóëÔ∏è</a>
              </td>
            </form>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p>No hay muestras registradas.</p>
      {% endif %}

      <!-- Eventos en tiempo real -->
      <div id="eventos" class="eventos"></div>
    </div>
  </div>
  <!-- SOCKET.IO -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="/static/socket.js"></script>
</body>
</html>
